<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Oracle 監聽程序（Listener）說明</title>
  <style>
    body{font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial; line-height:1.6; color:#222; padding:24px; background:#f7f8fb}
    .container{max-width:980px;margin:0 auto;background:white;padding:28px;border-radius:10px;box-shadow:0 8px 24px rgba(27,31,35,0.08)}
    h1{font-size:28px;margin-bottom:6px}
    h2{font-size:20px;margin-top:26px}
    p{margin:10px 0}
    pre{background:#0f1724;color:#e6eef8;padding:12px;border-radius:8px;overflow:auto}
    code{background:#eef2ff;padding:2px 6px;border-radius:4px}
    ul{margin:8px 0 8px 20px}
    table{border-collapse:collapse;width:100%;margin-top:8px}
    table th, table td{border:1px solid #e6e9ef;padding:8px;text-align:left}
    .note{background:#fff7ed;border-left:4px solid #ffb874;padding:10px;border-radius:6px;margin:12px 0}
    .diagram{display:flex;align-items:center;justify-content:center;margin:18px 0}
    .diagram .box{padding:12px 18px;border-radius:8px;background:#f1f5f9;margin:0 12px}
    .commands{margin-top:6px}
    footer{font-size:13px;color:#586069;margin-top:20px}
  </style>
</head>
<body>
  <div class="container">
    <h1>Oracle 監聽程序（Listener）說明</h1>
    <p>此文件將您提供的內容整理成結構化的 HTML 檔案，包含監聽程序的定義、功能、特性、管理命令、示意圖及新增/刪除監聽程序的步驟與注意事項。</p>

    <h2>一、監聽程序（Listener）是什麼？</h2>
    <p>在 Oracle 資料庫中，監聽程序（Listener）是一個在資料庫伺服器上運行的伺服器程式，負責接收客戶端的連線請求，然後將這些請求轉交給對應的資料庫實例處理。它是客戶端與資料庫之間的中介，確保資料庫可以接受遠端或本地的連線。</p>

    <h2>二、監聽程序的功能</h2>
    <ul>
      <li><strong>接收連線請求：</strong>客戶端程式（如 SQL*Plus、JDBC、TOAD）向監聽程序發送連線請求。</li>
      <li><strong>解析連線資訊：</strong>監聽程序會解析請求中指定的資料庫服務名稱（Service Name）或 SID。</li>
      <li><strong>轉交請求給資料庫實例：</strong>根據配置，監聽程序將請求轉給對應的資料庫執行緒或實例。</li>
      <li><strong>返回連線結果：</strong>成功連線後，監聽程序返回客戶端連線成功資訊；若失敗，則返回錯誤訊息。</li>
    </ul>

    <h2>三、常見特性</h2>
    <ul>
      <li><strong>多協議支援：</strong>Oracle Listener 支援 TCP/IP、TCP/IP with SSL、IPC 等協議。</li>
      <li><strong>集中管理：</strong>一個監聽程序可以監控多個資料庫實例。</li>
      <li><strong>配置文件：</strong>listener.ora：監聽程序的主要設定檔，包括監聽地址、端口號（預設 1521）、協議等。</li>
      <li><strong>動態服務註冊：</strong>從 Oracle 10g 開始，資料庫實例可以自動向監聽程序註冊（Dynamic Service Registration），不必手動修改 listener.ora。</li>
    </ul>

    <h2>四、常用管理命令（lsnrctl）</h2>
    <p>使用 <code>lsnrctl</code> 工具管理 Oracle Listener：</p>
    <div class="commands">
      <pre># 啟動監聽程序
lsnrctl start

# 停止監聽程序
lsnrctl stop

# 重啟或重新載入設定
lsnrctl reload

# 查看監聽狀態
lsnrctl status
</pre>
    </div>

    <h2>五、簡單示意圖</h2>
    <div class="diagram">
      <div class="box">[客戶端]</div>
      <div>&#8594;</div>
      <div class="box">TCP/IP</div>
      <div>&#8594;</div>
      <div class="box">[Oracle Listener]</div>
      <div>&#8594;</div>
      <div class="box">[Database Instance]</div>
    </div>
    <p>監聽程序本身不處理 SQL 查詢，它只負責「接線、轉交」，真正執行查詢的是資料庫實例。</p>

    <h2>六、Oracle 監聽程序可以有多個</h2>
    <p>Oracle 預設會有一個主要的監聽程式，通常名稱為：<code>LISTENER</code>。但您可以依需要新增或刪除多個監聽程序（例如不同的埠口、協議或資料庫實例），這在多實例、多服務或不同安全網段的環境中非常常見。</p>

    <h2>七、新增監聽程序的方式</h2>
    <h3>方法一：使用 Net Configuration Assistant（netca）</h3>
    <ol>
      <li>在伺服器上執行：<code>netca</code></li>
      <li>選擇「Listener configuration」。</li>
      <li>點選 <em>Add</em>，輸入新監聽器名稱（例如 <code>LISTENER2</code>）。</li>
      <li>選擇通訊協定（例如 TCP），設定監聽的埠號（例如 1522）。</li>
      <li>儲存並完成設定。完成後，會在 <code>$ORACLE_HOME/network/admin/listener.ora</code> 中自動新增設定。</li>
    </ol>

    <h3>方法二：手動編輯 <code>listener.ora</code></h3>
    <p>範例設定（通常放在 <code>$ORACLE_HOME/network/admin/listener.ora</code>）：</p>
    <pre>LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = mydbserver)(PORT = 1521))
    )
  )

LISTENER2 =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = mydbserver)(PORT = 1522))
    )
  )
</pre>
    <p>然後啟動新監聽程序：</p>
    <pre>lsnrctl start LISTENER2</pre>

    <h2>八、刪除監聽程序的方式</h2>
    <h3>方法一：使用 netca</h3>
    <ol>
      <li>開啟 Net Configuration Assistant（netca）。</li>
      <li>選擇 Listener configuration，點選 <em>Delete</em>。</li>
      <li>選擇要刪除的監聽器名稱。</li>
    </ol>

    <h3>方法二：手動刪除設定</h3>
    <ol>
      <li>開啟 <code>listener.ora</code>。</li>
      <li>刪除對應監聽器的區塊（例如 <code>LISTENER2</code> 的設定）。</li>
      <li>儲存檔案，執行：</li>
    </ol>
    <pre>lsnrctl stop LISTENER2
lsnrctl reload</pre>

    <h2>九、注意事項</h2>
    <table>
      <thead>
        <tr><th>注意項目</th><th>說明</th></tr>
      </thead>
      <tbody>
        <tr><td>監聽埠號</td><td>不同監聽器應使用不同埠號（例如 1521、1522）。</td></tr>
        <tr><td>主機名稱 / 網卡</td><td>若主機有多張網卡或多個 IP，可分別監聽不同網段。</td></tr>
        <tr><td>資料庫動態註冊</td><td>監聽程序啟動後，資料庫會自動向監聽器註冊（需設定 <code>LOCAL_LISTENER</code> 參數）。</td></tr>
        <tr><td>防火牆</td><td>記得開放對應的 TCP 埠號。</td></tr>
      </tbody>
    </table>

    <h2>十、常見管理命令總表</h2>
    <pre>lsnrctl start LISTENER2    -- 啟動指定監聽程序
lsnrctl stop LISTENER2     -- 停止指定監聽程序
lsnrctl status LISTENER2   -- 查看監聽狀態
lsnrctl reload             -- 重新載入 listener.ora 設定
</pre>

    <div class="note">
      <strong>補充：</strong>監聽程序主要負責連線管理與轉交，SQL 查詢等實際工作由後端的資料庫實例負責執行。
    </div>

    <footer>製作：ChatGPT • 內容來源：使用者提供與整理</footer>
  </div>
</body>
</html>